<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Välkommen till påskäggsköparsidan!</title>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            socket = io('http://localhost:8081');
            socket.on('onEnter', (eggs) => {
                console.log('Connected to server')
                createList(eggs)
            })
            socket.on('EggDeleted', () => {
                console.log('An egg has been deleted')
                createList(eggs)

            })
            socket.on('Egg', (egg) => {
                console.log('Egg incomming!!')
                createList(egg)

            })
        })

        function createList(eggs){
            console.log(eggs)
            // let a = document.getElementByid("egg")

            for( let i = 0; i < eggs.length; i++){

                let oneEgg = document.createElement("section")
                oneEgg.setAttribute("id", eggs[i]._id)
                

                let deleteEgg = document.createElement("button")
                deleteEgg.setAttribute("innerHTML", "Delete egg")
                deleteEgg.setAttribute("onclick", delEgg(eggs[i]._id))
                oneEgg.appendChild(deleteEgg)

                let name = document.createElement("div")
                name.setAttribute("innerHtml", eggs[i].name)  
                name.innerText = eggs[i].name
                oneEgg.appendChild(name)
               
                let candy
                for( q = 0; 0 < eggs[i].candy[q].length; q++ ) {

                    candy[q] = document.createElement("div")
                    candy.setAttribute("innerHTML", eggs[i].candy[q].amount)
                    candy.innerText = eggs[i].candy[q].amount
                    oneEgg.appendChild(candy[q])

                }

                let totalPrice = document.createElement("div")
                totalPrice.setAttribute("innerHTML", eggs[i].candy[q].amount)
                totalPrice.innerText = eggs[i].candy[q].amount
                oneEgg.appendChild(totalPrice)

                let getanEgg = document.createElement("button")
                getanEgg.setAttribute("innerHTML", "get egg")
                getanEgg.addEventListener("click", getEgg(eggs[i]._id))
                oneEgg.appendChild(getanEgg)
                oneEgg.appendChild(getanEgg)
                
                
                document.getElementById("egg").appendChild(oneEgg)
                
                

            }

        }
        function getEgg(id) {
            console.log("Sendiserar lite")

            socket.emit("getEgg", id)

        }
        function delEgg(id){

            socket.emit("deleteEgg", id)
        }

    </script>
</head>
<body>
    <h1>Hej och välkommen till egglistan!</h1>

    <section id="egg">
        
        
    </section>
    <button >Gå till konsument sidan</button>
</body>
</html>