<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Välkommen till påskäggsköparsidan!</title>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            socket = io('http://localhost:8081');
            socket.on('onEnter', (eggs) => {
                console.log('Connected to server')
                createList(eggs)
            })
            socket.on('EggDeleted', () => {
                console.log('An egg has been deleted')
                createList(eggs)

            })
            socket.on('Egg', (egg) => {
                console.log('Egg incomming!!')
                createList(egg)

            })
        })

        function createList(eggs) {
            console.log(eggs)
            console.log(eggs.Sql[0][0].name)


            for (let i = 0; i < eggs.mongo.length; i++) {
                let oneEgg = document.createElement("section")
                oneEgg.setAttribute("id", eggs.mongo[i]._id)
                


                let deleteEgg = document.createElement("button")
                deleteEgg.innerHTML = "Delete egg"
                deleteEgg.setAttribute("onclick", `delEgg(${eggs.mongo[i]._id})`)
                oneEgg.appendChild(deleteEgg)

                let name = document.createElement("div")
                name.innerHTML = eggs.mongo[i].name
                oneEgg.appendChild(name)

                for (let q = 0; q < eggs.mongo[i].candy.length; q++) {

                    let candy = document.createElement("div")

                    candy.innerHTML = eggs.Sql[i][q].name + ' ' + eggs.mongo[i].candy[q].amount + ' st'
                    // candy.innerText = eggs.mongo[i].candy[q].amount
                    oneEgg.appendChild(candy)

                }

                // let totalPrice = document.createElement("div")
                // totalPrice.innerHTML = eggs[i].candy[q].amount
                // // totalPrice.innerText = eggs[i].candy[q].amount
                // oneEgg.appendChild(totalPrice)

                let getanEgg = document.createElement("button")
                getanEgg.innerHTML = "Go to egg"
                getanEgg.addEventListener("click", () => {
                    getEgg(eggs.mongo[i]._id)
                })
                oneEgg.appendChild(getanEgg)

                document.getElementById("egg").appendChild(oneEgg)



            }

        }
        function getEgg(id) {
            console.log("Sendiserar lite " + id)

            socket.emit("getEgg", id)

        }
        function delEgg(id) {

            socket.emit("deleteEgg", id)
        }

    </script>
</head>

<body>
    <h1>Hej och välkommen till egglistan!</h1>

    <section id="egg">


    </section>
    <button>Gå till konsument sidan</button>
</body>

</html>