<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tillverkarsidan</title>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            socket = io('http://localhost:8081');
            socket.on('onConnection', (data) => {
                console.log(data)
                let session = sessionStorage.getItem('userLoggedIn')
                console.log(session)

                if (session !== null ){
                    console.log("we are here")

                    // createList(candies)

                } else {
                    let name = document.getElementById('producerName')
                    let candy = document.getElementById('producerCandies')
                    h1.innerHTML = "Du är inte inloggad din n00b!"
                    name.remove()  
                    candy.remove()                    
                }
                
            })

            socket.on('onProducerEnter', (candies) => {
                console.log('Connected to server from Producer page')
                createList(candies)
            })
        })
        function logOut(){
            try{
                sessionStorage.removeItem('userLoggedIn')
                window.location.href = 'http://localhost:8081/'
            } catch (err) {
                console.log(err)
            }
        }

        function createList(candies) {
            console.log('Är jag här?')
            let producer = document.getElementById('producerCandies')
            producerName.innerHTML = candies[0].Producer
            for (let i = 0; i < candies.length; i++) {

                //Skapa en sektion per godissort
                let oneCandy = document.createElement('section')
                oneCandy.setAttribute('id', candies[i].id)

                //Skapa en "ta bort godis"-knapp
                let deleteCandy = document.createElement('button')
                deleteCandy.innerHTML = "Delete candy"
                deleteCandy.setAttribute('onclick', `delCandy(${candies[i].ID})`)
                oneCandy.appendChild(deleteCandy)

                //Namn på godissorten
                let candy = document.createElement('div')
                candy.innerHTML = candies[i].Candy
                oneCandy.appendChild(candy)

                //Kategori
                let category = document.createElement('div')
                category.innerHTML = candies[i].Category
                oneCandy.appendChild(category)

                //Färg
                let color = document.createElement('div')
                color.innerHTML = candies[i].Color
                oneCandy.appendChild(color)

                //Pris
                let price = document.createElement('div')
                price.innerHTML = candies[i].Price
                oneCandy.appendChild(price)

                //Saldo
                let balance = document.createElement('div')
                balance.innerHTML = candies[i].Balance
                oneCandy.appendChild(balance)
                
                //Godisavskiljare
                let separation = document.createElement('div')
                separation.innerHTML = "-----------------------------------"
                oneCandy.appendChild(separation)

                producer.appendChild(oneCandy)
            }

        }
    </script>
</head>

<body>
    <h1 id= "h1">Hej och välkommen till producentsidan</h1>
    <h2 id='producerName'></h2>
    <section id="producerCandies"></section>
    <input type="button" onclick="logOut()" value="Logout!">
</body>

</html>