<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tillverkarsidan</title>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            socket = io('http://localhost:8081');
            socket.on('onConnection', (data) => {
                console.log(data)
                let id = sessionStorage.getItem('userLoggedIn')
                console.log(id)

                if (id !== null ){
                    console.log("we are here")

                    getList(id)

                } else {
                    let name = document.getElementById('producerName')
                    let candy = document.getElementById('producerCandies')
                    h1.innerHTML = "Du är inte inloggad din n00b!"
                    name.remove()  
                    candy.remove()                    
                }
                
            })

            socket.on('onProducerEnter', (candies) => {
                console.log('Connected to server from Producer page')
                createList(candies)
            })
        })
        function logOut(){
            try{
                sessionStorage.removeItem('userLoggedIn')
                window.location.href = 'http://localhost:8081/'
            } catch (err) {
                console.log(err)
            }
        }
        function addNewCandySort() {
            let newCandyData = {}
            newCandyData.id = sessionStorage.getItem('userLoggedIn')
            newCandyData.name = document.getElementById('name').value
            newCandyData.category = document.getElementById('category').value
            newCandyData.color = document.getElementById('color').value
            newCandyData.amount = document.getElementById('amount').value
            newCandyData.price = document.getElementById('price').value
            console.log(newCandyData)

            socket.emit('addnewCandySort', newCandyData)
        }

        function getList(id){
            socket.emit('getProducerView', id)
        }
        function deleteCandy(candyId){
            let id = {}
            id.candy = candyId
            id.producer = sessionStorage.getItem('userLoggedIn')
            console.log(id)
            socket.emit('deleteCandySort', id)
        }

        function createList(candies) {
            console.log(candies)
            let producer = document.getElementById('producerCandies')
            while ( producer.firstChild ) {
                producer.removeChild( producer.lastChild )
            }
            producerName.innerHTML = candies[0].producer
            for (let i = 0; i < candies.length; i++) {

                //Skapa en sektion per godissort
                let oneCandy = document.createElement('section')
                oneCandy.setAttribute('id', candies[i].id)

                //Skapa en "ta bort godis"-knapp
                let deleteCandy = document.createElement('button')
                deleteCandy.innerHTML = "Delete candy"
                deleteCandy.setAttribute('onclick', `deleteCandy(${candies[i].id})`)
                oneCandy.appendChild(deleteCandy)

                //Namn på godissorten
                let candy = document.createElement('div')
                candy.innerHTML = candies[i].name
                oneCandy.appendChild(candy)

                //Kategori
                let category = document.createElement('div')
                category.innerHTML = candies[i].category
                oneCandy.appendChild(category)

                //Färg
                let color = document.createElement('div')
                color.innerHTML = candies[i].color
                oneCandy.appendChild(color)

                //Pris
                let price = document.createElement('div')
                price.innerHTML = candies[i].price
                oneCandy.appendChild(price)

                //Saldo
                let balance = document.createElement('div')
                balance.innerHTML = candies[i].balance
                oneCandy.appendChild(balance)
                
                //Godisavskiljare
                let separation = document.createElement('div')
                separation.innerHTML = "-----------------------------------"
                oneCandy.appendChild(separation)

                producer.appendChild(oneCandy)
            }

        }
    </script>
</head>

<body>
    <h1 id= "h1">Hej och välkommen till producentsidan</h1>
    <h2 id='producerName'></h2>
    <section id="producerCandies"></section>
    <section id='addNewCandySort'>
        <h3>Lägg till en ny godis!</h3>
        <input type="text" id="name" value='namn'>
        <select type="text" id="category" value='chocolate'>
            <option value="chocolate">Chocolate</option>
            <option value="Liquorice">Liquorice</option>
            <option value="Marshmallow">Marshmallow</option>
            <option value="Toffee">Toffee</option>
            <option value="Bar">Bar</option>
            <option value="Lollipop">Lollipop</option>
        
        
        </select>
        <select type="text" id="color" value='red'>
            <option value="red">red</option>
            <option value="blue">blue</option>
            <option value="green">green</option>
            <option value="brown">brown</option>
            <option value="black">black</option>
            <option value="white">white</option>
            <option value="yellow">yellow</option>
            <option value="pink">pink</option>
            <option value="various">various</option>
        </select>
        <input type="number" id="amount" value='10'>
        <input type="number" id="price" value='5'>
        <input type="button" onclick="addNewCandySort()" value="Add New Candy">
    </section>
    <input type="button" onclick="logOut()" value="Logout!">


</body>

</html>